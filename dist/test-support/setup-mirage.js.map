{"version":3,"file":"setup-mirage.js","sources":["../../src/test-support/setup-mirage.js"],"sourcesContent":["import { assert } from '@ember/debug';\nimport { settled } from '@ember/test-helpers';\nimport { createServer as _createServer } from 'miragejs';\n\nexport function setupMirage(hooks = self, { createServer, config }) {\n  assert(\n    `Unexpected arity for setupMirage. Expected 2 (hooks, { createServer, or config })`,\n    arguments.length <= 2 && arguments.length > 0,\n  );\n  assert(\n    `Second argument to setupMirage must be an object and not null`,\n    typeof arguments[1] === 'object' && arguments[1] !== null,\n  );\n  assert(\n    `Second argument to setupMirage must on or both of createServer and/or config. You passed ${Object.keys(arguments[1]).join(', ')}`,\n    'createServer' in arguments[1] || 'config' in arguments[1],\n  );\n\n  createServer ??= _createServer;\n\n  hooks.beforeEach(async function () {\n    if (!this.owner) {\n      throw new Error(\n        'You must call one of the ember-qunit setupTest(),' +\n          ' setupRenderingTest() or setupApplicationTest() methods before' +\n          ' calling setupMirage()',\n      );\n    }\n    const store = this.owner.lookup(\"service:store\");\n    this.server = await createServer(config ?? {}, store);\n    if (this.server.start) {\n      await this.server.start();\n    }\n  });\n\n  hooks.afterEach(function () {\n    return settled().then(() => {\n      if (this.server) {\n        this.server.shutdown();\n        delete this.server;\n      }\n    });\n  });\n}\n"],"names":["setupMirage","hooks","self","createServer","config","assert","arguments","length","Object","keys","join","_createServer","beforeEach","owner","Error","store","lookup","server","start","afterEach","settled","then","shutdown"],"mappings":";;;;AAIO,SAASA,WAAWA,CAACC,KAAK,GAAGC,IAAI,EAAE;gBAAEC,cAAY;AAAEC,EAAAA;AAAO,CAAC,EAAE;AAClEC,EAAAA,MAAM,CACJ,CAAA,iFAAA,CAAmF,EACnFC,SAAS,CAACC,MAAM,IAAI,CAAC,IAAID,SAAS,CAACC,MAAM,GAAG,CAC9C,CAAC;AACDF,EAAAA,MAAM,CACJ,CAA+D,6DAAA,CAAA,EAC/D,OAAOC,SAAS,CAAC,CAAC,CAAC,KAAK,QAAQ,IAAIA,SAAS,CAAC,CAAC,CAAC,KAAK,IACvD,CAAC;AACDD,EAAAA,MAAM,CACJ,CAAA,yFAAA,EAA4FG,MAAM,CAACC,IAAI,CAACH,SAAS,CAAC,CAAC,CAAC,CAAC,CAACI,IAAI,CAAC,IAAI,CAAC,CAAA,CAAE,EAClI,cAAc,IAAIJ,SAAS,CAAC,CAAC,CAAC,IAAI,QAAQ,IAAIA,SAAS,CAAC,CAAC,CAC3D,CAAC;AAEDH,EAAAA,cAAY,KAAKQ,YAAa;EAE9BV,KAAK,CAACW,UAAU,CAAC,kBAAkB;AACjC,IAAA,IAAI,CAAC,IAAI,CAACC,KAAK,EAAE;MACf,MAAM,IAAIC,KAAK,CACb,mDAAmD,GACjD,gEAAgE,GAChE,wBACJ,CAAC;AACH;IACA,MAAMC,KAAK,GAAG,IAAI,CAACF,KAAK,CAACG,MAAM,CAAC,eAAe,CAAC;AAChD,IAAA,IAAI,CAACC,MAAM,GAAG,MAAMd,cAAY,CAACC,MAAM,IAAI,EAAE,EAAEW,KAAK,CAAC;AACrD,IAAA,IAAI,IAAI,CAACE,MAAM,CAACC,KAAK,EAAE;AACrB,MAAA,MAAM,IAAI,CAACD,MAAM,CAACC,KAAK,EAAE;AAC3B;AACF,GAAC,CAAC;EAEFjB,KAAK,CAACkB,SAAS,CAAC,YAAY;AAC1B,IAAA,OAAOC,OAAO,EAAE,CAACC,IAAI,CAAC,MAAM;MAC1B,IAAI,IAAI,CAACJ,MAAM,EAAE;AACf,QAAA,IAAI,CAACA,MAAM,CAACK,QAAQ,EAAE;QACtB,OAAO,IAAI,CAACL,MAAM;AACpB;AACF,KAAC,CAAC;AACJ,GAAC,CAAC;AACJ;;;;"}